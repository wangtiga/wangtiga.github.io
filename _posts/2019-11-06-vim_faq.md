---
layout: post
title:  "vim 问题记录"
date:   2019-11-06 08:17:00 +0800
tags:   linux
---

* category
{:toc}


## vim FAQ


### 误操作导致 vim 界面卡住不动，按任何按键都没反应，怎么办？
```shell
Ctrl + s  " 开启锁屏状态

Ctrl + q  " 退出锁屏状态
```



### 如何显示历史提示?

```shell
:messages

vim-go: [definition] FAIL
vim-go: go [list -e -json -compiled=true -test=true -export=false -deps=true -find=false -mod=readonly -- myproject/mq]: exit status 1: go: updates to go.sum needed, disabled by -mod=readonly
请按 ENTER 或其它命令继续

```


### 如何在 NERDTree 中定位当前打开的文件？

### Disable vim automatic visual mode on mouse select
```shell
:set mouse-=a " Disable vim automatic visual mode on mouse select
```

https://gist.github.com/u0d7i/01f78999feff1e2a8361

### 如何让当前行总是保持在屏幕中央？

```shell
:set so=7  " 设置光标上下两侧最少保留的屏幕行数
```

> so 表示 scrolloff ， 如果这个值超过当前屏幕显示的行数，当前光标行会一直显示在屏幕中央


### 如何让两个 windows 窗口同时滚动？

对比两个文件的差异时会用到这个命令

```shell
:set scb   " 同时滚动
:set noscb " 关闭同时滚动
```

> scb 表示 scrollbind

### 如何将批量转换字母的大小写？

使用 v 选中要转换的单词，然后按 gu gU 进行转换

```shell
gu	" 转小写
gU	" 转大写
```

```shell
～		" 将光标下的字母改变大小写
3～		" 将光标位置开始的3个字母改变其大小写
g~~		" 改变当前行字母的大小写
U		" 将可视模式下选择的字母全改写成大写字母
u		" 将可视模式下选择的字母全改成小写字母
gUU		" 将当前行的字母改成大写
guu		" 将当前行的字母改成小写
3gUU	" 将从光标开始到下面3行字母改成大写
gUw		" 将那个光标下的单词改成大写
guw		" 将光标下的单词改成小写
```


### 如何使用vimdiff作为git mergetool ？

[https://kinboy.wang/2018/10/09/Use-Vimdiff-As-Git-Mergetool/](https://kinboy.wang/2018/10/09/Use-Vimdiff-As-Git-Mergetool/)

```shell
git config merge.tool vimdiff
git config merge.conflictstyle diff3
git config mergetool.prompt false
```

从左至右，从上到下：

1. LOCAL - 这个文件来自当前分支；
2. BASE - 两个分支的共同祖先，在两个分支上的文件改变之前的样子；
3. REMOTE - 要合并到你当前分支的外部分支上的文件；
4. MERGED - 合并结果，将会保存到本地repo中。

假设我们希望保留octodog 的变化（来自REMOTE）。为此，移动到MERGED文件上（Ctrl + w, j）,移动光标到一个合并冲突的区域，然后：

```shell
:diffget RE
```

你也可以：

```shell
:diffg RE  " get from REMOTE
:diffg BA  " get from BASE
:diffg LO  " get from LOCAL
```

保存文件，然后退出（快速保存写入并退出的方法是:wap ）


### 如何显示 空格、换行、制表符 等符号？

[stackoverflow make-vim-show-all-white-spaces-as-a-character](https://stackoverflow.com/questions/1675688/make-vim-show-all-white-spaces-as-a-character)

```shell
:set list   " to enable.
:set nolist " to disable.
:set list!  " to toggle it.
```


### 如何高亮显示当前光标所在单词

[highlight-all-occurrence-of-a-selected-word](https://stackoverflow.com/questions/3431184/highlight-all-occurrence-of-a-selected-word)
[vim-clear-last-search-highlighting](https://stackoverflow.com/questions/657447/vim-clear-last-search-highlighting)

使用`hlsearch`高亮显示`/`搜索的关键词，`*`快捷键搜索当前光标所有的word

```shell
:set hlsearch " 开启高亮
:nohlsearch   " 永久关闭高亮
:noh          " 临时关闭高亮，下次搜索时自动打开高亮
*  " Normal mode 中向下搜索当前光标所在单词
#  " Normal mode 中向上搜索当前光标所在单词
```


### 如何查看当前文件的编码

[vim_fileencodings_detection.html](http://edyfox.codecarver.org/html/vim_fileencodings_detection.html)

[vim-encodings-latin1-and-utf-8](https://stackoverflow.com/questions/25115752/vim-encodings-latin1-and-utf-8)

[vims-encoding-options](https://stackoverflow.com/questions/8121609/vims-encoding-options)

```shell
:echo &fileencoding
```


### 如何重载 .vimrc 文件？

```shell
:source ~/.vimrc
```


### 如何在 C++ 的 `*.h`头文件和`*.cpp`文件之间切换？

[stackoverflow](https://stackoverflow.com/questions/17170902/in-vim-how-to-switch-quickly-between-h-and-cpp-files-with-the-same-name)

`%`表示当前完整的文件名

`:r`表示移除文件后缀的文件名称，只移除最后一个后台，详见` :h extension-removal`

`%<`表示不带文件后缀的文件名称

```shell
:e %:r.cpp
:e %<.cpp
```


### 如何搜索当前光标所在的单词

目前搜索一个单词需要`yw` 复制，然后输入`:vimgrep /xxxxx/ **/*.go` 搜索，其中还要用 `Ctrl+r "`粘贴

可以映射一个键盘快捷键`gR`快速执行这个步骤
[Find_in_files_within_Vim](https://vim.fandom.com/wiki/Find_in_files_within_Vim)

```shell
" 在当前目录的*.go文件中，搜索当前光标所在的单词                                                
nnoremap gG :execute "vimgrep /" . expand("<cword>") . "/j **/*.go" <Bar> cw<CR>
```

- 如何在打开`*.go`文件时，只搜索`*.go`的文件；打开`*.cpp`时，只搜索`*.cpp`的文件呢？

- 关于 map 映射命令
[zhihu](https://www.zhihu.com/question/20741941)

```shell
map a b       " 表示按 a 等于按 b。
vmap          " (还有 nmap imap）前首字母表示不同的模式（分别对应虚拟模式，普通模式，插入模式）。
vnoremap c a  " nore表示非递归。
              " 比如我们之前设置按 a 等于按 b, 假设我们设置按 c 等于按 a .则我们按下 c 相当于按了 b。
              " 如果是 nore 的映射，按下 c 只等于按 a。 至于前面的 v，跟第二条一样表示不同的模式。
```


### 如果显示函数列表？

golang 中搜索包含以func字符的开关行，就是函数列表

然后输入:g跳转到指定行号就能定位到函数所在位置

```shell
:g/^func#
:g123
```

其他编程语言，建议安装 tagbar 插件查看函数列表


### 如何确定某个键盘快捷键有什么用途？

[stackoverflow](https://stackoverflow.com/questions/7047650/in-vim-how-to-find-out-what-a-key-combination-does)

```shell
:help CTRL-I  " 查询指定快捷键的帮助手册
:map          " 列出所有当前的自定义快捷键。对于在 .vimrc 文件或第三方 plugin 中自定义的按键，:help 中是查询不到手册的。这时只能用 :map 命令
```

map命令的输出示例

- 第1列表示快捷键应用在 insert/visual/normal 哪种模式
- 第2列表示快捷键  the keyboard shortcut
- 第3列表示快捷键执行的命令 the command that is run

```shell
   <C-P>                      <Plug>(ctrlp)
v  gx                         <Plug>NetrwBrowseXVis
n  gx                         <Plug>NetrwBrowseX
n  <Plug>(go-iferr)           * :<C-U>call go#iferr#Generate()<CR>
n  <Plug>(go-alternate-split) * :<C-U>call go#alternate#Switch(0, "split")<CR>
```


### 如何折叠函数？如何仅在需要时，折叠或展开？

[stackoverflow](https://stackoverflow.com/questions/2362914/fold-function-in-vim)

[wizardforcel.gitbooks](https://wizardforcel.gitbooks.io/use-vim-as-ide/content/4.html)

```shell
set foldmethod=syntax " 开启按语法折叠的功能
set nofoldenable      " 启动 vim 时关闭折叠代码

zc                    " 折叠当前函数， zM 折叠所有函数
zo                    " 展开当前函数， zR 展开所有函数
za                    " 打开或关闭当前折叠

" set foldmethod=indent " 开启按缩进折叠的功能
" set foldclose=all     " 默认导开所有折叠，未生效，暂不确定原因
" set foldopen=all      " 默认导开所有折叠，未生效，暂不确定原因
```


### 同时打开了多个文件window时，如何临时把一个文件全屏显示？[table]

[stackoverflow](https://stackoverflow.com/questions/15583346/how-can-i-temporarily-make-the-window-im-working-on-to-be-fullscreen-in-vim)

```shell
" 方法一 推荐此方法
:tab split " 使用当前buffer打开一个新的tab，这应该是最好用的了
:tabc      " 关闭tab

" 方法二
:tabnew %   " 使用多标签功能，打开一个新标签
:tabn       ” 切换到下一个标签 Ctrl + PageDown 
:tabp       “ 切换到上一个标签 Ctrl + PageUp
:x          " 关闭新标签

" 方法三
Ctrl+W_ " will maximize a window vertically.
Ctrl+W| " will maximize a window horizontally.
Ctrl+W= " resize all windows to equal sizes.
        " So far as I'm aware, 
        " there is no way to restore the previous layout after these actions, 
        " but  Ctrl+W=  will resize all windows to equal sizes.
```


### 如何打开最近关闭的 window？  [windows buffers]

ls 命令中 `#` 开头的文件是`the alternate file`一般表示上一次编辑的文件

```shell
:ls       “ 显示最近打开的所有文件
:b#       “ 打开最近关闭的文件，在当前窗口打开。 vs # 和 sp # 都会在新窗口打开
:bNUM     ” 找到那个文件的序号NUM，在当前窗口打开
:vs #NUM  “ 在右侧窗口打开序号为NUM的文件，垂直分隔
:sp #NUM  ” 在下面的窗打开序号为NUM的文件，水平分隔
```

```shel
:help ls
                 %      the buffer in the current window
                 #      the alternate buffer for ":e #" and CTRL-^
                  a     an active buffer: it is loaded and visible
                  h     a hidden buffer: It is loaded, but currently not
                           displayed in a window hidden-buffer
                   -    a buffer with 'modifiable' off
                   =    a readonly buffer
```


### 如何批量注释多行代码， 批量编辑？

[stackoverflow](https://stackoverflow.com/questions/1676632/whats-a-quick-way-to-comment-uncomment-lines-in-vim)

```shell
-   press  Esc  (to leave editing or other mode)
-   hit  Ctrl+v  (visual block mode)
-   use the up/down arrow keys to select lines you want (it won't highlight everything - it's OK!)
-   Shift+i  (capital I)
-   insert the text you want, i.e.  `%` # 注意，这里编辑过程，只显示一行文字的变化，按 Esc 后才会看到完整效果
-   press  EscEsc
```


### 如何强制 quickfix 窗口默认在最底部显示？[quickfix]

[stackoverflow](https://stackoverflow.com/questions/6726783/changing-default-position-of-quickfix-window-in-vim)

```shell
:autocmd FileType qf wincmd J " 强制所有新打开的quickfix窗口都在最底部显示
```


### 如何允许 backspace 按键删除换行符号？

```shell
set backspace=indent,eol,start " backspace over everything in insert mode
```


### 如何把 yank 的信息粘贴到 command 中使用？ [yank] [register]

```shell
yaw       " 复制当前光标所在的单词
Ctrl+r 0  " 粘贴到当前光标所在位置
```

vim内置了多个寄存器，可以同时保存多条复制内容。其中0号寄存器是默认使用的寄存器。

- `0-9` : 0号寄存器表示最近一次操作的内容
- `a-z` `A-Z` : 用户寄存器
- `"` : 默认寄存器，删除复制等操作的内容默认保存在这里
- `+` :剪切板寄存器，关联系统剪切析

```shell
:reg    " 显示当前所有寄存器的内容
"+yy    " 复制当前行到剪切板， 注意前面的 `"` 是必须输入的符号
"ayy    " 复制当前行到a寄存器
"ap     " 将寄存器a的内容粘贴到光标后面
```


### 如何跳转到函数？

```shell
[[ " 跳转到上一个函数块开始，需要有单独一行的{。
]] " 跳转到下一个函数块开始，需要有单独一行的{。
[] " 跳转到上一个函数块结束，需要有单独一行的}。
][ " 跳转到下一个函数块结束，需要有单独一行的}。
```


### 如何跳转到函数或变量定义的地方? [ctag]

根据所查看的源码文件类型，要安装不同的插件，但基本原理都是基于 tag 来跳转， vim 的帮助文件中也是类型的跳转方式

```shell
Ctrl+] # 跳转到定义
Ctrl+T # 返回跳转前的位置
```

以下命令用于生成 tags 文件，方便使用 vim 查看 c 代码时自动实现自动跳转 `ctrl+]`
 
```shell
ctags -R --C-kinds=+p --fields=+S /usr/include
 
ctags -R --c++-kinds=+p --fields=+iaS --extra=+q /usr/include

https://blog.csdn.net/haifeng_gu/article/details/72933200

https://vim.fandom.com/wiki/Generate_ctags_file_for_a_C/C%2B%2B_source_file_with_all_of_their_dependencies_(standard_headers,_etc)
 
```


### 如何跳转到上次编辑的位置？ [jumplist]

```shell
'.  # Jump to last modification line.
`.  # Jump to exact spot in last modification line
Ctrl+O  # Retrace your movements in file in backwards.
Ctrl+I  # Retrace your movements in file in forwards.
```


### 如何滚动屏幕？

```shell
" 滚动屏幕，但光标位置不变 One line
Ctrl+Y # Move viewport down
Ctrl+E # Move viewport up (Extra lines)
" 滚动屏幕，但光标位置不变 Half a screen
Ctrl+U # Move viewport Up
Ctrl+D # Move viewport Down
```


### 移动到当前大括号{ 对应的另一个括号位置

```shell
% 
```


### 如何查找所有引用某个变量的地方？

搜索“引用”显量与搜索“关键”字不同。
前者需要对所用的编程语言进行语法分析，所以搜索结果更少、更精确。
所以不同的编程语言，解决方案也不同。

Golang 使用 [vim-go](https://github.com/fatih/vim-go-tutorial) 提供的 `GoReferrers` 命令会调用 `Guru` 实现这个功能

```shell
:GoReferrers " 查询当前所有引用了光标所有单词（变量、函数）
```


### 如何替换当前文件中所有关键字？

[Search_and_replace](https://vim.fandom.com/wiki/Search_and_replace)

```shell
:%s/foo/bar/gc  " Change each 'foo' to 'bar', but ask for confirmation first.
```

### 如何在 vimgrep CtrlP 功能中，过滤二进制文件？

[how-to-use-vimgrep-on-several-file-extensions](https://stackoverflow.com/questions/18977608/how-to-use-vimgrep-on-several-file-extensions)

```shell
set wildignore=*.dll,*.exe,*lib*so*,*.o " vimgrep CtrlP 功能中，隐藏二进制文件```
```


### 搜索所有*.cpp文件中 MEDIA_TYPE_VIDEO 关键字[vimgrep] [quicklist]

搜索结果保存在 quicklist 中 

```shell
:vimgrep /MEDIA_TYPE_VIDEO/j **/*.cpp ” 其中小写字母 j 表示,搜索完成后，不会自动跳转到第一个搜索结果
:cw                                   ” 显示搜索结果 quicklist
:cn                                   " 跳转到 quicklist 中下一个条目
:cp                                   " 跳转到 quicklist 中上一个条目
:h vimgrep                            “ 显示帮助 
```


### 如何按文件名称糊糊搜索，打开对应的文件？ [CtrlP 插件]

- 使用vundle安装插件，只用在 .vimrc 文件增加以下代码

```shell
Plugin 'majutsushi/tagbar'
```

- 保存 .vimrc 文件后，执行以下命令

```shell
:PluginInstall
```

> 手动下载安装CtrlP插件

```shell
git clone https://github.com/kien/ctrlp.vim.git bundle/ctrlp.vim

" 手动安装时，必须在 `~/.vimrc` 文件增加下面内容
set runtimepath^=~/.vim/bundle/ctrlp.vim " 启用 CtrlP 插件
```

- 个性化设置

```shell
let g:ctrlp_max_files=0
let g:ctrlp_match_window = 'bottom,order:btt,min:1,max:10,results:100' " 显示尽可能多的文件，方便自己手动选择需要的文件
let g:ctrlp_match_current_file = 1 " 显示已经打开的文件
```

- 刷新目录文件
  如果新增或删除了当前目录的文件，使用Ctrl+P搜索不到相关文件
  可以按F5重新扫描当前目录的文件

```shell
<F5>
  - Refresh the match window and purge the cache for the current directory.
  - Remove deleted files from MRU list.
```


### tagbar 插件

- 使用vundle安装插件，只用在 .vimrc 文件增加以下代码
```shell
Plugin 'majutsushi/tagbar'
```

- 保存 .vimrc 文件后，执行以下命令
```shell
:PluginInstall
```

- 打开关闭 tagbar
```shell
:TagbarToggle
```

- 安装ctag生成标签文件
  * CPlusPlus安装ctags生成标签，在[ctags官网](http://ctags.sourceforge.net/)下载源码编译安装后，在当前代码目录执行 `ctags -R`生成标签文件
  * Golang安装gotags生成标签，直接在命令行执行`go get -u github.com/jstemmer/gotags`就会自动下载源码编译
  * 另外，我目前没有手动执行相关命令，执行`:TagbarToggle` 就能正常使用，可能tagbar 插件会自动识别 CPlusPlus 和Golang源码并执行 ctags/gotags 生成标签吧。

- 参考
[https://github.com/yangyangwithgnu/use_vim_as_ide](https://github.com/yangyangwithgnu/use_vim_as_ide)


### vundle 插件

下载 vundle 插件后，更新 ~/.vimrc 文件内容即可

```shell
git clone https://github.com/VundleVim/Vundle.vim.git ~/.vim/bundle/Vundle.vim
```


## ~/.bashrc

```txt
$ cat ~/.bashrc 
# .bashrc

# User specific aliases and functions

alias rm='rm -i'
alias cp='cp -i'
alias mv='mv -i'
alias ll='ls -alFh'
alias gll='git branch -avv'
alias gdiff='git diff --color'

# Source global definitions
if [ -f /etc/bashrc ]; then
	. /etc/bashrc
fi

# add by ws
export GOPATH=/app/ws/gopath
export PATH=$PATH:$GOPATH/bin
export PATH=$PATH:/usr/local/go/bin

```


## ~/.vimrc

```txt

"
" 使用 vundle 安装管理其他插件
"
set nocompatible              " be iMproved, required
filetype off                  " required

" set the runtime path to include Vundle and initialize
set rtp+=~/.vim/bundle/Vundle.vim
call vundle#begin()
" alternatively, pass a path where Vundle should install plugins
"call vundle#begin('~/some/path/here')

" let Vundle manage Vundle, required
Plugin 'VundleVim/Vundle.vim'

Plugin 'kien/ctrlp.vim'

" Plugin 'wangtiga/vim-ydict'

" Plugin 'wangtiga/vim-im'

" Plugin 'majutsushi/tagbar'

" Plugin 'scrooloose/nerdtree'

" Plugin 'fatih/vim-go'

" All of your Plugins must be added before the following line
call vundle#end()            " required
filetype plugin indent on    " required


"
" 公共全局配置
"

" set runtimepath^=~/.vim/bundle/ctrlp.vim " 启用 CtrlP 插件
let g:ctrlp_max_files=0
let g:ctrlp_match_window = 'bottom,order:btt,min:1,max:10,results:100' " 显示尽可能多的文件，方便自己手动选择需要的文件
let g:ctrlp_match_current_file = 1 " 显示已经打开的文件

set imsearch=0   " disable vim-im plugin in search

" ydict search word
vnoremap tV :<C-u>Ydv<CR>
nnoremap tC :<C-u>Ydc<CR>
nnoremap tE :<C-u>Yde<CR>

" google translate shell 
nnoremap tG :!trans -t zh-cn "
vnoremap tT :<C-u>Ydt<CR>
" gG 在当前目录的*.go文件中，搜索当前光标所在的单词
" gF 在当前文件中，搜索当前光标所在的单词
" 后缀增加 <CR>  代表回车，可以输入快捷键后立即搜索
nnoremap gG :execute "vimgrep /" . expand("<cword>") . "/j **/*.go" <Bar> cw
nnoremap gF :execute "vimgrep /" . expand("<cword>") . "/j % " <Bar> cw

set backspace=indent,eol,start " backspace over everything in insert mode
autocmd FileType qf wincmd J   " 强制 quickfix 窗口默认在最底部显示

set scrolloff=99 ":set so=7  " 设置光标上下两侧最少保留的屏幕行数
set hlsearch     " 高亮显示当前搜索的关键字
set nu           " 显示行号
syntax on        " 语法高亮

set foldmethod=syntax " 开启按语法折叠的功能
set nofoldenable      " 启动 vim 时关闭折叠代码


```



